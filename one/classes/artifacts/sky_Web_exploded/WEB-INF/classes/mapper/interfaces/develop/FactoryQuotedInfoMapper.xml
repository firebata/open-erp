<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skysport.inerfaces.mapper.develop.FactoryQuotedInfoMapper">

    <sql id="searchInfoSql">
        id AS id,
        factory_quote_id AS factoryQuoteId,
        sp_id AS spId,
        offer_amount AS offerAmount,
        quote_ref AS quoteReference,
        fabrics_end_date AS fabricsEndDate,
        accessories_end_date AS accessoriesEndDate,
        preoffer_date AS preOfferDate,
        cloth_received_date AS clothReceivedDate,
        factory_offer AS factoryOffer,
        factory_margins AS factoryMargins,
        costing AS costing,
        bom_id AS bomId,
        euro_price AS euroPrice,
        del_flag AS delFlag,
        update_time AS updateTime,
        remark AS remark
    </sql>

    <select id="selectAlId" resultType="String">
      select factory_quote_id
      from t_kf_factory_quote a
       WHERE
        a.bom_id = #{bomId} and a.del_flag=0
    </select>

    <delete id="deleteByIds">
        update t_kf_factory_quote set del_flag=1
        where factory_quote_id IN
        <foreach item="idItem" collection="list" open="(" separator="," close=")">
            #{idItem}
        </foreach>
        ;
        update t_kf_production_instruction set del_flag=1
        where factory_quote_id IN
        <foreach item="idItem" collection="list" open="(" separator="," close=")">
            #{idItem}
        </foreach>
    </delete>

    <select id="queryInfo" resultType="FactoryQuoteInfo">
        select
        <include refid="searchInfoSql"/>
        FROM t_kf_factory_quote
        WHERE bom_id =#{bomId} and del_flag=0
        limit 1
    </select>


    <select id="queryProjectAndBomInfoByFactoryQuoteId" resultType="KfProductionInstructionEntity">
        SELECT
            a.project_name AS projectItemName,
            b.bom_name AS bomName,
            b.main_color AS colorName,
            d.sp_name AS spName
        FROM
            t_kf_project_item a,
            t_kf_bominfo b,
            t_kf_factory_quote c,
            t_jc_supplier d
        WHERE
            c.factory_quote_id =#{factoryQuoteId}
        AND a.project_id = b.project_id
        AND b.bom_id = c.bom_id
        AND c.sp_id = d.sp_id
        AND c.del_flag = 0
        AND a.del_flag = 0
        AND b.del_flag = 0
        limit 1
    </select>

    <update id="updateInfo">
        update
            t_kf_factory_quote
        set
            sp_id = #{spId},
            offer_amount = #{offerAmount},
            quote_ref = #{quoteReference},
            fabrics_end_date = #{fabricsEndDate},
            accessories_end_date = #{accessoriesEndDate},
            preoffer_date = #{preOfferDate},
            cloth_received_date = #{clothReceivedDate},
            factory_offer = #{factoryOffer},
            factory_margins = #{factoryMargins},
            costing = #{costing},
            euro_price  = #{euroPrice},
            bom_id = #{bomId},
            del_flag  = #{delFlag}
        WHERE
            factory_quote_id =#{factoryQuoteId}
    </update>

    <update id="updateProductionInstruction">
        update
        t_kf_production_instruction
        set
        sp_name                     = #{spName},
        offer_amout                 =#{offerAmout},
        cloth_received_date         =#{clothReceivedDate},
        crop_requirements     = #{cropRequirements},
        quality_requirements     = #{qualityRequirements},
        overstitch               = #{overstitch},
        overstitch_space         = #{overstitchSpace},
        blindstitch               = #{blindstitch},
        blindstitch_space          = #{blindstitchSpace},
        overlock                  = #{overlock},
        overlock_space              = #{overlockSpace},
        finish_pressing_requirements= #{finishPressingRequirements},
        spcial_tech                 = #{spcialTech},
        packing_requirements        = #{packingRequirements},
        trademark_code              = #{trademarkCode},
        trademark_remark            = #{trademarkRemark},
        scale_code                  = #{scaleCode},
        scale_remark                = #{scaleRemark},
        rinsing_marks_code          = #{rinsingMarksCode},
        rinsing_marks_remark        = #{rinsingMarksRemark}
        WHERE
        factory_quote_id =#{factoryQuoteId}
    </update>

    <insert id="add">
        insert into  t_kf_factory_quote (bom_id,sp_id,offer_amount,quote_ref,fabrics_end_date,accessories_end_date,preoffer_date,cloth_received_date,factory_offer,factory_margins,costing,remark,name_num,euro_price,factory_quote_id)
        values (#{bomId},#{spId},#{offerAmount},#{quoteReference},#{fabricsEndDate},#{accessoriesEndDate},#{preOfferDate},#{clothReceivedDate},#{factoryOffer},#{factoryMargins},#{costing},#{remark},#{nameNum},#{euroPrice},#{factoryQuoteId})
    </insert>

    <insert id="addProductionInstruction">
        insert into
        t_kf_production_instruction(uid,factory_quote_id,bom_id,project_item_name,bom_name,sp_id,sp_name,color_name,offer_amout,cloth_received_date,crop_requirements,quality_requirements,overstitch,overstitch_space,blindstitch,blindstitch_space,overlock,overlock_space,finish_pressing_requirements,spcial_tech,packing_requirements,trademark_code,trademark_remark ,scale_code ,scale_remark,rinsing_marks_code,rinsing_marks_remark)
        values(#{uid},#{factoryQuoteId},#{bomId},#{projectItemName},#{bomName},#{spId},#{spName},#{colorName},#{offerAmout},#{clothReceivedDate},#{cropRequirements},#{qualityRequirements},#{overstitch},#{overstitchSpace},#{blindstitch},#{blindstitchSpace},#{overlock},#{overlockSpace},#{finishPressingRequirements},#{spcialTech},#{packingRequirements},#{trademarkCode},#{trademarkRemark},#{scaleCode},#{scaleRemark},#{rinsingMarksCode},#{rinsingMarksRemark})
    </insert>


    <update id="del">
        update t_kf_factory_quote
        set  del_flag=1
        where bom_id =#{bomId}
    </update>


    <sql id="searcProductionInstractionInfoSql">
        id								AS 	 id,
        uid                 			AS   uid,
        uid                 			AS   productionInstructionId,
        factory_quote_id    			AS   factoryQuoteId,
        bom_id              			AS   bomId,
        project_item_name   			AS   projectItemName,
        bom_name            			AS   bomName,
        sp_id               			AS   spId,
        sp_name							AS   spName,
        color_name          			AS   colorName,
        offer_amout         			AS   offerAmout,
        crop_requirements    			AS   cropRequirements,
        quality_requirements     		AS   qualityRequirements,
        overstitch               		AS   overstitch,
        overstitch_space         		AS   overstitchSpace,
        blindstitch               		AS   blindstitch,
        blindstitch_space          		AS   blindstitchSpace,
        overlock                  		AS   overlock,
        overlock_space              	AS   overlockSpace,
        finish_pressing_requirements	AS   finishPressingRequirements,
        spcial_tech                 	AS   spcialTech,
        packing_requirements        	AS   packingRequirements,
        trademark_code              	AS   trademarkCode,
        trademark_remark            	AS   trademarkRemark,
        scale_code                  	AS   scaleCode,
        scale_remark                	AS   scaleRemark,
        rinsing_marks_code          	AS   rinsingMarksCode,
        rinsing_marks_remark        	AS   rinsingMarksRemark,
        del_flag                        AS   delFlag,
        update_time                     AS   updateTime,
        remark                          AS   remark
    </sql>

    <select id="queryProductionInstractionInfo" resultType="KfProductionInstructionEntity">
        SELECT
        <include refid="searcProductionInstractionInfoSql"/>
        FROM
        t_kf_production_instruction a
        WHERE
        a.factory_quote_id =#{factoryQuoteId} and a.del_flag=0
    </select>


    <select id="queryFactoryQuoteInfoList" resultType="FactoryQuoteInfo">
        SELECT
        <include refid="searchInfoSql"/>
        FROM
        t_kf_factory_quote a
        WHERE
        a.bom_id = #{bomId} and a.del_flag=0
        ORDER BY a.name_num ASC
    </select>

</mapper>